<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>CKEditor 5 – Docflow build</title>
  <style>
    body {
      max-width: 800px;
      margin: 20px auto;
    }

    .ck.ck-editor__editable.ck-blurred {
      border: 1px solid var(--ck-color-base-border);
    }

  </style>
</head>

<body>
  <h1>CKEditor 5 – Docflow build</h1>

  <div id="editor">
    <p id="7v23pgj">asd asd asd as
      Lipsum <strong>lorem</strong> ipsum dolor sit
      amet, <span data-comment-id="MK">consectetur</span>
      adipiscing elit. Fusce pretium dolor nec nunc hendrerit ultrices. Nulla at fermentum lectus. Mauris quis felis
      dapibus, molestie quam eget, bibendum risus. Proin fringilla blandit ipsum eu sollicitudin. Nulla congue
      porttitor, a gravida nibh aliquet sed. Sed mollis augue
      quis orci ornare, at aliquet
      lectus viverra.
      Fusce nec enim vel massa faucibus dictum sit amet nec elit.
    </p>
  </div>

  <button id="button-get" type="button">Get Data</button>
  <script src="../build/ckeditor.js"></script>
  <script>
    CKEDITOR.InlineEditor.create(document.querySelector("#editor"))
      .then(editor => {
        window.editor = editor;
      })
      .catch(err => {
        console.error(err.stack);
      });

    const getData = () => {
      window.editor.execute("removeComment", {
        id: "MK"
      });

      // setTimeout(() => {
      //   console.log("SET");
      //   window.editor.execute("setCommentId", { id: "123" });
      // }, 2000);
      // const ranges = Array.from(window.editor.model.document.selection.getRanges());
      // const firstRange = window.editor.model.document.selection.getFirstRange().start;
      // const firstItemId = firstRange?.parent.getAttribute("id");
      // const lastRange = window.editor.model.document.selection.getLastRange().end;
      // const lastItemId = lastRange?.parent.getAttribute("id");
      // const selectedElements = Array.from(window.editor.model.document.selection.getSelectedBlocks());

      // const list = [];

      // for (const range of ranges) {
      //   const items = Array.from(range.getItems());
      //   for (const item of items) {
      //     if (item.is("$textProxy")) {
      //       const parent = item.parent;
      //       const leafId = parent.getAttribute("id");
      //       list.push({
      //         leafId: leafId,
      //         text: item.data,
      //         start: item.offsetInText,
      //         end: item.offsetInText + item.offsetSize,
      //         index: Array.from(parent.getChildren()).indexOf(item.textNode)
      //       });
      //     }
      //   }
      // }

      // console.log("list", list)
    };

    document
      .querySelector("#button-get")
      .addEventListener("click", getData);
  </script>
</body>

</html>
